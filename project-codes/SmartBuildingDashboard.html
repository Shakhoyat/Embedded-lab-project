<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Building Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }

        .emergency-alert {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            display: none;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .room-card {
            border-left: 5px solid #2ed573;
        }

        .room-card.warning {
            border-left-color: #ffa502;
        }

        .room-card.emergency {
            border-left-color: #ff4757;
            animation: shake 0.5s infinite;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-safe {
            background-color: #2ed573;
        }

        .status-warning {
            background-color: #ffa502;
        }

        .status-emergency {
            background-color: #ff4757;
        }

        .sensor-reading {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .sensor-label {
            font-weight: bold;
            color: #333;
        }

        .sensor-value {
            color: #666;
        }

        .environmental-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .environmental-card h3 {
            color: white;
            border-bottom-color: white;
        }

        .environmental-card .sensor-reading {
            background: rgba(255, 255, 255, 0.1);
        }

        .environmental-card .sensor-label,
        .environmental-card .sensor-value {
            color: white;
        }

        .alerts-section {
            margin-top: 30px;
        }

        .alert-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid #ff4757;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }

        .refresh-btn {
            background: #00b894;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .refresh-btn:hover {
            background: #00a085;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üè† Smart Building Monitor</h1>
            <p>3-Room Intelligent Safety System</p>
        </div>

        <div class="emergency-alert" id="emergencyAlert">
            üö® EMERGENCY ALERT: Fire detected! Contact emergency services immediately! üö®
        </div>

        <div class="status-bar">
            <span>System Status: <strong id="systemStatus">Loading...</strong></span>
            <span style="margin-left: 20px;">Last Update: <strong id="lastUpdate">--</strong></span>
            <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh</button>
        </div>

        <div class="dashboard">
            <!-- Environmental Conditions -->
            <div class="card environmental-card">
                <h3>üå°Ô∏è Environmental Conditions</h3>
                <div class="sensor-reading">
                    <span class="sensor-label">Temperature:</span>
                    <span class="sensor-value" id="temperature">--¬∞C</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Humidity:</span>
                    <span class="sensor-value" id="humidity">--%</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Precise Temperature:</span>
                    <span class="sensor-value" id="preciseTemp">--¬∞C</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Air Quality:</span>
                    <span class="sensor-value" id="airQuality">--</span>
                </div>
            </div>

            <!-- Bedroom -->
            <div class="card room-card" id="bedroomCard">
                <h3>üõèÔ∏è Bedroom</h3>
                <div class="sensor-reading">
                    <span class="sensor-label">Status:</span>
                    <span class="sensor-value">
                        <span class="status-indicator status-safe" id="bedroomIndicator"></span>
                        <span id="bedroomStatus">SAFE</span>
                    </span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Fire Sensor:</span>
                    <span class="sensor-value" id="bedroomFire">No Fire</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Gas Level:</span>
                    <span class="sensor-value" id="bedroomGas">--</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Last Update:</span>
                    <span class="sensor-value" id="bedroomUpdate">--</span>
                </div>
            </div>

            <!-- Kitchen -->
            <div class="card room-card" id="kitchenCard">
                <h3>üç≥ Kitchen</h3>
                <div class="sensor-reading">
                    <span class="sensor-label">Status:</span>
                    <span class="sensor-value">
                        <span class="status-indicator status-safe" id="kitchenIndicator"></span>
                        <span id="kitchenStatus">SAFE</span>
                    </span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Fire Sensor:</span>
                    <span class="sensor-value" id="kitchenFire">No Fire</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Gas Level:</span>
                    <span class="sensor-value" id="kitchenGas">--</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Last Update:</span>
                    <span class="sensor-value" id="kitchenUpdate">--</span>
                </div>
            </div>

            <!-- Parking Lot -->
            <div class="card room-card" id="parkingCard">
                <h3>üöó Parking Lot</h3>
                <div class="sensor-reading">
                    <span class="sensor-label">Status:</span>
                    <span class="sensor-value">
                        <span class="status-indicator status-safe" id="parkingIndicator"></span>
                        <span id="parkingStatus">SAFE</span>
                    </span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Fire Sensor:</span>
                    <span class="sensor-value" id="parkingFire">No Fire</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Gas Level:</span>
                    <span class="sensor-value" id="parkingGas">--</span>
                </div>
                <div class="sensor-reading">
                    <span class="sensor-label">Last Update:</span>
                    <span class="sensor-value" id="parkingUpdate">--</span>
                </div>
            </div>
        </div>

        <div class="alerts-section">
            <div class="card">
                <h3>üö® Recent Alerts</h3>
                <div id="alertsList">
                    <p style="text-align: center; color: #666;">No recent alerts</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Smart Building Monitoring System v1.0 | Real-time IoT Dashboard</p>
            <p>Powered by Arduino Mega + ESP32 + Firebase</p>
        </div>
    </div>

    <script type="module">
        // Firebase configuration - Replace with your config
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js';

        const firebaseConfig = {
            // Replace with your Firebase configuration
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            databaseURL: "https://your-project.firebaseio.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Real-time data listeners
        function setupRealtimeListeners() {
            // Environmental data
            const envRef = ref(database, 'smartBuilding/environmental');
            onValue(envRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('temperature').textContent = `${data.temperature || '--'}¬∞C`;
                    document.getElementById('humidity').textContent = `${data.humidity || '--'}%`;
                    document.getElementById('preciseTemp').textContent = `${data.preciseTemperature || '--'}¬∞C`;
                    document.getElementById('airQuality').textContent = data.airQuality || '--';
                    document.getElementById('lastUpdate').textContent = data.lastUpdated || '--';
                }
            });

            // Room data listeners
            setupRoomListener('bedroom', 'üõèÔ∏è Bedroom');
            setupRoomListener('kitchen', 'üç≥ Kitchen');
            setupRoomListener('parking', 'üöó Parking Lot');

            // System status
            const systemRef = ref(database, 'smartBuilding/system');
            onValue(systemRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('systemStatus').textContent = data.buildingStatus || 'Unknown';

                    // Show/hide emergency alert
                    const emergencyAlert = document.getElementById('emergencyAlert');
                    if (data.showEmergencyAlert) {
                        emergencyAlert.style.display = 'block';
                    } else {
                        emergencyAlert.style.display = 'none';
                    }
                }
            });

            // Alerts listener
            const alertsRef = ref(database, 'smartBuilding/alerts');
            onValue(alertsRef, (snapshot) => {
                const alertsData = snapshot.val();
                updateAlertsList(alertsData);
            });
        }

        function setupRoomListener(roomName, displayName) {
            const roomRef = ref(database, `smartBuilding/rooms/${roomName}`);
            onValue(roomRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    updateRoomDisplay(roomName, data);
                }
            });
        }

        function updateRoomDisplay(roomName, data) {
            const card = document.getElementById(`${roomName}Card`);
            const indicator = document.getElementById(`${roomName}Indicator`);
            const status = document.getElementById(`${roomName}Status`);
            const fire = document.getElementById(`${roomName}Fire`);
            const gas = document.getElementById(`${roomName}Gas`);
            const update = document.getElementById(`${roomName}Update`);

            // Update status
            status.textContent = data.status || 'Unknown';
            fire.textContent = data.flameDetected ? 'üî• FIRE DETECTED!' : '‚úÖ No Fire';
            gas.textContent = data.gasLevel || '--';
            update.textContent = data.lastUpdated || '--';

            // Update visual indicators
            card.className = 'card room-card';
            indicator.className = 'status-indicator';

            if (data.emergency) {
                card.classList.add('emergency');
                indicator.classList.add('status-emergency');
            } else if (data.dangerous) {
                card.classList.add('warning');
                indicator.classList.add('status-warning');
            } else {
                indicator.classList.add('status-safe');
            }
        }

        function updateAlertsList(alertsData) {
            const alertsList = document.getElementById('alertsList');

            if (!alertsData) {
                alertsList.innerHTML = '<p style="text-align: center; color: #666;">No recent alerts</p>';
                return;
            }

            const alerts = Object.values(alertsData).sort((a, b) =>
                new Date(b.timestamp) - new Date(a.timestamp)
            ).slice(0, 5); // Show last 5 alerts

            if (alerts.length === 0) {
                alertsList.innerHTML = '<p style="text-align: center; color: #666;">No recent alerts</p>';
                return;
            }

            alertsList.innerHTML = alerts.map(alert => `
                <div class="alert-item">
                    <strong>${alert.type}:</strong> ${alert.message}<br>
                    <small>üìç ${alert.room} - ${alert.timestamp}</small>
                </div>
            `).join('');
        }

        // Initialize real-time listeners
        setupRealtimeListeners();

        // Make refreshData function global
        window.refreshData = function () {
            location.reload();
        };

        // Auto-refresh every 30 seconds
        setInterval(() => {
            console.log('Auto-refreshing data...');
        }, 30000);
    </script>
</body>

</html>